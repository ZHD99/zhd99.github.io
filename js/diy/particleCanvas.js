"use strict";!function(){var i=function(e,t){var a,n,o,i;return(i={type:e.type,reIn:e.reIn,cacheImage:null,color:e.color,x:null,y:null,reInX:null,reInY:null,rota:{},zoom:e.zoom.min+(e.zoom.max-e.zoom.min)*Math.random(),speed:e.speed.min+(e.speed.max-e.speed.min)*Math.random(),size:null,flowAngle:e.flowAngle,mouseAngle:null,opc:e.op.min+(e.op.max-e.op.min)*Math.random(),angle:e.angle.value+(e.angle.float*Math.random()-e.angle.float/2),img:null}).size=this.dealSize(e.type,e.size),0!==e.rota.value&&(o=this.dealRota(e.rota),i.rota.value=o.value,i.rota.speed=o.speed),n=this.createPosition(e.area),i.x=n.x,i.y=n.y,a=this.reIn(t,i.reIn,i.angle,i.x,i.y,i.size,i.speed,e,i),i.reInX=a.x>>0,i.reInY=a.y>>0,i.cacheImage=this.drawPoint(i.type,i.size,i.opc,i.color,i.zoom),i.size=i.cacheImage.width,i};i.prototype={drawPoint:function(e,t,a,n,o){var i,r;switch(i=document.createElement("canvas"),void 0!==window.G_vmlCanvasManager&&(i=window.G_vmlCanvasManager.initElement(i)),r=i.getContext("2d"),e.typeName){case"circle":i.width=2*t,i.height=2*t,r.globalAlpha=a,r.fillStyle=n,r.beginPath(),r.arc(t,t,t,0,2*Math.PI,!0),r.closePath(),r.fill();break;case"image":i.width=t,i.height=t,r.globalAlpha=a;var l=new Image;l.src=e.url,l.complete?r.drawImage(l,0,0,t,t):(l.onload=function(){r.drawImage(l,0,0,t,t)},l.onerror=function(){console.log(e.url+"加载失败，请重试")});break;case"shape":var s;t*=o,i.width=t,i.height=t,r.globalAlpha=a,r.fillStyle=n,r.strokeStyle=n,r.lineWidth=e.lineWidth,s=e.vertexData,r.scale(o,o),r.beginPath(),r.moveTo(s[0][0],s[0][1]);for(var h=s.length,u=1;u<h;++u)r.lineTo(s[u][0],s[u][1]);r.lineTo(s[0][0],s[0][1]),r.stroke(),r.fill(),r.closePath()}return i},reIn:function(e,t,a,n,o,i,r,l,s){var h,u,c,d,m;switch(t){case"reverseDirection":m=(a-180)/180*Math.PI;for(var p=1;p<=e.width;p+=r)if(c=n+Math.cos(m)*p,d=o+Math.sin(m)*p,270<a&&a<=360){if(c<=0||d>=e.height){c-=i,d+=i;break}}else if(180<a&&a<=270){if(c>=e.width||d>=e.height){c+=i,d+=i;break}}else if(90<a&&a<=180){if(c>=e.width||d<=0){c+=i,d-=i;break}}else if(c<=0||d<=0){c-=i,d-=i;break}h=c,u=d,"replaceInitPosition"===l.reverseDirection&&(s.x=c>>0,s.y=d>>0);break;default:h=n,u=o}return{x:h>>0,y:u>>0}},createPosition:function(e){return{x:Math.random()*(e.rightBottom[0]-e.leftTop[0])+e.leftTop[0]>>0,y:Math.random()*(e.rightBottom[1]-e.leftTop[1])+e.leftTop[1]>>0}},dealRota:function(e){var t,a;return e.floatValue&&(t=Math.random()*e.floatValue-e.floatValue/2+e.value),e.floatSpeed&&(a=Math.random()*e.floatSpeed-e.floatSpeed/2+e.speed),{value:t,speed:a}},dealSize:function(e,t){var a;switch(e.typeName){case"shape":var n,o,i;o=(n=e.vertexData)[0][0],i=n[0][1];for(var r=n.length-1;0<=r;--r)n[r][0]>o&&(o=n[r][0]),n[r][0]>i&&(i=n[r][1]);a=i<o?o:i;break;default:a=t.min+(t.max-t.min)*Math.random()}return a}};var r=function e(t,a){if(this.canvasE=document.getElementById(t),this.ctx=this.canvasE.getContext("2d"),this.canvasWidth=this.canvasE.width,this.canvasHeight=this.canvasE.height,e.defaultParameter.area.rightBottom[0]=this.canvasWidth,e.defaultParameter.area.rightBottom[1]=this.canvasHeight,0!==a.length){var n;this.canvasId=t,n=[];for(var o=0,i=a.length;o<i;++o)n.push(a[o]);this.useParameter=this.formatParameter(n),this.unDrawPoint=this.createpointGroup(),this.pointGroup=[],this.dealInitFill(),this.mouseArrayIndex=this.onMouse(),0<this.pointGroup.length?this.draw(this):console.log("没有可绘制的图像,检测number参数是否大于0")}else console.log("没有找到组件实例化参数")};r.prototype={formatParameter:function(e){var t,a;a=[],e=e||{};for(var n=0;n<e.length;++n){for(var o in t={},r.defaultParameter)t[o]=e[n][o]?e[n][o]:r.defaultParameter[o];a.push(t)}return a},createpointGroup:function(){var e,t,a;t=[];for(var n=0;n<this.useParameter.length;++n){a=[];for(var o=(e=this.useParameter[n]).number;0<o;--o)a.push(new i(e,this.canvasE));t.push(a)}return t},dealInitFill:function(){for(var e=0,t=this.unDrawPoint.length;e<t;++e){var a=e,n=this.useParameter[e],o="undefined"==n.delayFill?this.unDrawPoint[a].length:n.delayFill.initNumber;if(o!==this.unDrawPoint[a].length){this.pointGroup[a]=[];for(var i=0,r=o;i<r;++i){if(this.unDrawPoint[a].length<=0)return;this.pointGroup[a].push(this.unDrawPoint[a].pop())}}else this.pointGroup[a]=this.unDrawPoint[a]}},dealDelayFill:function(e,t){var a=t.delayFill;this.unDrawPoint[e].length<=0||(void 0===t.nowFrame&&(t.nowFrame=0),t.nowFrame===a.fixed&&(this.pointGroup[e].push.apply(this.pointGroup[e],this.unDrawPoint[e].splice(0,a.oneTimesNumber)),t.nowFrame=0),++t.nowFrame)},update:function(){var e,t;if(null!==this.mouseArrayIndex)for(var a=this.mouseArrayIndex.length-1;0<=a;--a)for(var n=this.pointGroup[this.mouseArrayIndex[a]],o=n.length-1;0<=o;--o)void 0!==window.particleCanvasMouseAngle&&(n[o].mouseAngle=window.particleCanvasMouseAngle);for(var i=0;i<this.pointGroup.length;++i)for(a=(e=this.pointGroup[i]).length-1;0<=a;--a)(t=e[a]).x<-t.size-t.speed-10||t.y<-t.size-t.speed-10||t.x>this.canvasWidth+t.size+t.speed+10||t.y>this.canvasHeight+t.size+t.speed+10?(t.x=t.reInX,t.y=t.reInY):(t.x+=Math.cos(t.angle/180*Math.PI)*t.speed,t.y+=Math.sin(t.angle/180*Math.PI)*t.speed),0!==t.rota.value?t.rota.value+=t.rota.speed:t.flowAngle},draw:function(e){void 0!==window.G_vmlCanvasManager?this.draw=this.drawLow:this.draw=this.drawHigh,this.draw(e)},drawHigh:function(e){var t,a,n,o;this.canvasE.width=this.canvasE.width;for(var i=0;i<this.pointGroup.length;++i){(o=this.useParameter[i]).delayFill&&this.dealDelayFill(i,o);for(var r=(a=this.pointGroup[i]).length-1;0<=r;--r)null!==(t=a[r]).mouseAngle&&(t.angle=t.mouseAngle),0===t.rota.speed?this.ctx.drawImage(t.cacheImage,t.x-t.size,t.y-t.size):("on"==t.flowAngle?(this.ctx.save(),n=t.size/2,this.ctx.translate(t.x+n,t.y+n),this.ctx.rotate(t.angle*Math.PI/180)):(this.ctx.save(),n=t.size/2,this.ctx.translate(t.x+n,t.y+n),this.ctx.rotate(t.rota.value*Math.PI/180)),this.ctx.translate(-t.x-n,-t.y-n),this.ctx.drawImage(t.cacheImage,t.x,t.y),this.ctx.restore())}this.update(),rAF(function(){e.draw(e)})},drawLow:function(e){var t,a;t=this.ctx,this.canvasE.width=this.canvasE.width;for(var n=0;n<this.pointGroup;++n)for(var o=this.pointGroup[n].length,i=0;i<o;++i)switch((a=this.pointGroup[n][i]).type.typeName){case"circle":t.globalAlpha=a.opc,t.fillStyle=a.color,t.beginPath(),t.arc(a.x,a.y,a.size,0,2*Math.PI,!0),t.closePath(),t.fill();break;case"image":if(null===a.img){var r=new Image;r.src=a.type.url}t.drawImage(r,a.x,a.y,a.size,a.size);break;case"shape":var l;a.size*a.zoom,t.globalAlpha=a.opc,t.fillStyle=a.color,t.strokeStyle=a.color,t.lineWidth=a.type.lineWidth,l=a.type.vertexData,t.save(),t.scale(a.zoom,a.zoom),t.beginPath(),t.moveTo(a.x+l[0][0],a.y+l[0][1]);for(o=l.length,i=1;i<o;++i)t.lineTo(a.x+l[i][0],a.y+l[i][1]);t.lineTo(a.x+l[0][0],a.y+l[0][1]),t.stroke(),t.fill(),t.closePath(),t.restore()}this.update(),rAF(function(){e.draw(e)})},onMouse:function(){for(var e=[],t=this.useParameter.length-1;0<=t;--t)"on"===this.useParameter[t].respondMouse&&e.push(t);return 0==e.length?null:(document.getElementById(this.canvasId).onmousemove=function(){a(event,1e3,600)},e)}};var a=function(e,t,a){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1;var n=e.touches?e.touches[0]:e,o=(n.pageX?n.pageX:e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft))-t/2,i=(n.pageY?n.pageY:e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop))-a/2,r=Math.sqrt(o*o+i*i),l=Math.acos(o/r);window.particleCanvasMouseAngle=0<=i?180*l/Math.PI>>0:180-180*l/Math.PI+180>>0};r.defaultParameter={area:{leftTop:[0,0],rightBottom:[null,null]},number:50,type:{typeName:"circle"},rota:{value:0,speed:0,floatValue:100,floatSpeed:.1},zoom:{min:1,max:1},reIn:"reverseDirection",color:"#FF4040",size:{min:2,max:2},speed:{min:4,max:4},angle:{value:30,float:0},op:{min:1,max:1},reverseDirection:null,respondMouse:"off",flowAngle:"off",delayFill:"undefined"},window.particleCanvas=r,window.rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},function(){if(!document.createElement("canvas").getContext){document.createElement("canvas");var e=document.createElement("script");e.src="js/excanvas.js",document.getElementsByTagName("head")[0].appendChild(e)}}()}(window);