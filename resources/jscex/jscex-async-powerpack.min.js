"use strict";!function(){var r=function(e){if(e.length<=1)return null;for(var t=[],n=1;n<e.length;n++)t.push(e[n]);return t},o=function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r]);for(;n.length<t;)n.push(void 0);return n},i=function(e){if(!e.modules["async-powerpack"]){if(!e.modules.async)throw Error('Missing essential components, please initialize "jscex-async" module first.');var t=e.Async,f=t.Task,c=t.CanceledError;t.sleep=function(r,i){return f.create(function(e){var t,n;i&&i.isCancellationRequested&&e.complete("failure",new c),i&&(n=function(){clearTimeout(t),e.complete("failure",new c)}),t=setTimeout(function(){i&&i.unregister(n),e.complete("success")},r),i&&i.register(n)})},t.onEvent=function(i,s,o){return f.create(function(t){o&&o.isCancellationRequested&&t.complete("failure",new c);var e,n,r=function(){i.removeEventListener?i.removeEventListener(s,e):i.removeListener?i.removeListener(s,e):i.detachEvent(s,e)};o&&(n=function(){r(),t.complete("failure",new c)}),e=function(e){o&&o.unregister(n),r(),t.complete("success",e)},i.addEventListener?i.addEventListener(s,e):i.addListener?i.addListener(s,e):i.attachEvent(s,e),o&&o.register(n)})},f.whenAll=function(){var a,u={};if(1==arguments.length){var e=arguments[0];a=f.isTask(e)?(u[0]=e,!0):(u=e,"[object Array]"===Object.prototype.toString.call(u))}else{for(e=0;e<arguments.length;e++)u[e]=arguments[e];a=!0}return f.create(function(r){var e,i={};for(e in u)if(u.hasOwnProperty(e)){var t=u[e];f.isTask(t)&&(i[t.id]=e)}for(var n in i)"ready"==(t=u[i[n]]).status&&t.start();for(n in i)if((t=u[i[n]]).error)return void r.complete("failure",t.error);var s=a?[]:{},o=function e(t){if(t.error){for(var n in i)u[i[n]].removeEventListener("complete",e);r.complete("failure",t.error)}else s[i[t.id]]=t.result,delete i[t.id],0==--c&&r.complete("success",s)},c=0;for(n in i)e=i[n],"succeeded"==(t=u[e]).status?(s[e]=t.result,delete i[t.id]):(c++,t.addEventListener("complete",o));0==c&&r.complete("success",s)})},f.whenAny=function(){var o={};if(1==arguments.length){var e=arguments[0];f.isTask(e)?o[0]=e:o=e}else for(e=0;e<arguments.length;e++)o[e]=arguments[e];return f.create(function(r){var e,i={};for(e in o)if(o.hasOwnProperty(e)){var t=o[e];f.isTask(t)&&(i[t.id]=e)}for(var n in i)"ready"==(t=o[i[n]]).status&&t.start();for(n in i)if(e=i[n],(t=o[e]).error||"succeeded"==t.status)return void r.complete("success",{key:e,task:t});var s=function e(t){for(var n in i)o[i[n]].removeEventListener("complete",e);r.complete("success",{key:i[t.id],task:t})};for(n in i)o[i[n]].addEventListener("complete",s)})},t.Jscexify||(t.Jscexify={}),(t=t.Jscexify).fromStandard=function(n){var s=r(arguments);return function(){var e=this,t=o(arguments,n.length-1);return f.create(function(i){t.push(function(e,t){if(e)i.complete("failure",e);else{if(s){for(var n={},r=0;r<s.length;r++)n[s[r]]=arguments[r+1];return i.complete("success",n)}i.complete("success",t)}}),n.apply(e,t)})}},t.fromCallback=function(n){var i=r(arguments);return function(){var e=this,t=o(arguments,n.length-1);return f.create(function(r){t.push(function(e){if(i){for(var t={},n=0;n<i.length;n++)t[i[n]]=arguments[n];r.complete("success",t)}else r.complete("success",e)}),n.apply(e,t)})}},e.modules["async-powerpack"]=!0}},e="function"==typeof define&&!define.amd,t="function"==typeof require&&"function"==typeof define&&define.amd;if("function"==typeof require&&"undefined"!=typeof module&&module.exports)module.exports.init=i;else if(e)define("jscex-async-powerpack",["jscex-async"],function(e,t,n){n.exports.init=i});else if(t)define("jscex-async-powerpack",["jscex-async"],function(){return{init:i}});else{if("undefined"==typeof Jscex)throw Error('Missing the root object, please load "jscex" module first.');i(Jscex)}}();